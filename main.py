from flask import Flask, request, jsonify
import sys
from predict.ai import checkFile
from flask_cors import CORS

app = Flask(__name__)
CORS(app) 
CORS(app, origins='*')  # Allow requests from any origin


@app.route('/', methods=['GET'])
def index():
    return "Hello World"

@app.route('/check_malware', methods=['POST'])
def check_malware():
    file = request.files['file']
    filename = file.filename
    file.save(filename)
    
    legitimate = checkFile(filename)
    print(legitimate)
    result = {}
    if legitimate == 1:
        result = {
            'checked': True,
            'message': f"File {filename} seems legitimate."
        }
    elif legitimate == 0:
        result = {
            'checked': True,
            'message': f"File {filename} seems a MALWARE!!!"
        }
    
    # elif legitimate == -1:
    #     result = {
    #         'checked': False,
    #         'message': f"{filename} cannot be used to check malware."
    #     }
    # elif legitimate == 104:
    #     result = {
    #         'checked': False,
    #         'message': f"AI Model not found."
    #     },
    # elif legitimate == 105:
    #     result = {
    #         'checked': False,
    #         'message': f"Feature File not found."
    #     }
    # else:
    #     result = {
    #         'checked': False,
    #         'message': f"Unknown error."
    #     }

    return jsonify(result)


if __name__ == "__main__":
    app.run()